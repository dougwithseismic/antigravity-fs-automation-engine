
> api@ test /Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/apps/api
> vitest

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m

 DEV  v1.6.1 /Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/apps/api

 âœ“ src/index.test.ts  (1 test) 1ms
stdout | src/execution/nodes/ppc.test.ts > PPC Nodes > ConditionNode should return true when match
[ConditionNode] Checking utm_source=ppc against { utm_source: 'ppc' } Match: true

stdout | src/execution/nodes/ppc.test.ts > PPC Nodes > ConditionNode should return false when no match
[ConditionNode] Checking utm_source=ppc against { utm_source: 'organic' } Match: false

 âœ“ src/execution/nodes/ppc.test.ts  (3 tests) 2ms
stdout | src/execution/nodes/ppc.test.ts > PPC Nodes > DiscountNode should return a code
[DiscountNode] ğŸŸï¸ Generated Code: SAVE10

 âœ“ src/execution/nodes/human.test.ts  (1 test) 1ms
stdout | src/execution/engine.debt.test.ts > Engine Technical Debt > should cancel a running execution
[Execution 123] Running workflow Test Workflow (1)
[Execution 123] Executing node node1 (long-running)

 âœ“ src/validation/validator.test.ts  (4 tests) 3ms
 âœ“ src/execution/engine.test.ts  (5 tests) 4ms
stdout | src/execution/engine.test.ts > Execution Engine > should execute a simple linear workflow
[Execution 100] Running workflow Test Workflow (1)
[Execution 100] Executing node 1 (scifi)
[Execution 100] Executing node 2 (scifi)
[Execution 100] completed

stdout | src/execution/engine.test.ts > Execution Engine > should suspend execution when a node returns suspended status
[Execution 101] Running workflow Suspended Workflow (1)
[Execution 101] Executing node 1 (scifi)
[Execution 101] Executing node 2 (human-approval)
[Execution 101] Suspended at node 2
[Execution 101] waiting

stdout | src/execution/engine.test.ts > Execution Engine > should suspend execution and return nextStep when encountering a client node
[Execution 102] Running workflow Hybrid Workflow (1)
[Execution 102] Executing node 1 (scifi)
[Execution 102] Suspending for Client Handoff at node 2

stdout | src/execution/engine.test.ts > Execution Engine > should skip execution if step is already completed (idempotency)
[Execution 103] Running workflow Idempotent Workflow (1)
[Execution 103] Skipping node 1 (Already Completed)
[Execution 103] Executing node 2 (scifi)
[Execution 103] completed

stdout | src/execution/engine.test.ts > Execution Engine > should pass AbortSignal to node executor
[Execution 104] Running workflow Abortable Workflow (1)
[Execution 104] Executing node 1 (abortable)
[Execution 104] completed

 âœ“ src/execution/engine.validation.test.ts  (1 test) 4ms
stdout | src/execution/engine.validation.test.ts > Engine Validation > should fail execution if workflow is invalid
[Execution 1] Running workflow Test Workflow (1)

stderr | src/execution/engine.validation.test.ts > Engine Validation > should fail execution if workflow is invalid
Execution failed: Error: Workflow validation failed: [condition] condition: Invalid input: expected object, received undefined
    at runExecution (/Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/apps/api/src/execution/engine.ts:99:19)
    at /Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/apps/api/src/execution/engine.validation.test.ts:49:24
    at runTest (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:781:11)
    at runSuite (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)
    at runSuite (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:909:15)
    at runFiles (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:958:5)
    at startTests (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/@vitest+runner@1.6.1/node_modules/@vitest/runner/dist/index.js:967:3)
    at file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.25_jsdom@27.2.0_lightningcss@1.30.2/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:116:7
    at withEnv (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.25_jsdom@27.2.0_lightningcss@1.30.2/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:83:5)
    at run (file:///Users/godzillaaa/Documents/WEB_PROJECTS/clients/withseismic/antigravity/node_modules/.pnpm/vitest@1.6.1_@types+node@20.19.25_jsdom@27.2.0_lightningcss@1.30.2/node_modules/vitest/dist/chunks/runtime-runBaseTests.oAvMKtQC.js:105:3)

 âœ“ src/routes/workflows.test.ts  (3 tests) 6ms
stdout | src/routes/workflows.test.ts > Workflow API > should create a valid workflow
Creating workflow Valid Workflow
Workflow created 1

stdout | src/routes/workflows.test.ts > Workflow API > should reject invalid condition node
Creating workflow Invalid Workflow

stdout | src/routes/workflows.test.ts > Workflow API > should reject invalid analytics node
Creating workflow Invalid Workflow

stdout | src/execution/engine.debt.test.ts > Engine Technical Debt > should cancel a running execution
[Execution 123] Cancelled by user request

 â¯ src/execution/engine.debt.test.ts  (2 tests | 1 failed) 5003ms
   â¯ src/execution/engine.debt.test.ts > Engine Technical Debt > should cancel a running execution
     â†’ Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
stdout | src/execution/engine.debt.test.ts > Engine Technical Debt > should merge results on completion
[Execution 123] Running workflow Test Workflow (1)
[Execution 123] Executing node node1 (start)
[Execution 123] completed


â¯â¯â¯â¯â¯â¯â¯ Failed Tests 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  src/execution/engine.debt.test.ts > Engine Technical Debt > should cancel a running execution
Error: Test timed out in 5000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/1]â¯

 Test Files  1 failed | 7 passed (8)
      Tests  1 failed | 19 passed (20)
   Start at  23:10:37
   Duration  5.15s (transform 185ms, setup 0ms, collect 349ms, tests 5.02s, environment 1ms, prepare 311ms)


 FAIL  Tests failed. Watching for file changes...
       press h to show help, press q to quit
â€‰ELIFECYCLEâ€‰ Test failed. See above for more details.
